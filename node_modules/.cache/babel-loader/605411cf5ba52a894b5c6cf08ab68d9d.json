{"ast":null,"code":"import _defineProperty from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useRef,useContext,useState}from'react';import Codemirror from'codemirror';import'codemirror/lib/codemirror.css';import'codemirror/theme/dracula.css';import'codemirror/mode/javascript/javascript';import'codemirror/mode/python/python';import'codemirror/addon/edit/closetag';import'codemirror/addon/edit/closebrackets';import ACTIONS from'../Actions';import{SocketContext}from'../socket';import{jsx as _jsx}from\"react/jsx-runtime\";var Editor=function Editor(_ref){var roomId=_ref.roomId,onCodeChange=_ref.onCodeChange,selectedLanguage=_ref.selectedLanguage;var editorRef=useRef(null);var socketContext=useContext(SocketContext);var _useState=useState({}),_useState2=_slicedToArray(_useState,2),userCursors=_useState2[0],setUserCursors=_useState2[1];useEffect(function(){var editor;var init=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:editor=Codemirror.fromTextArea(document.getElementById('realtimeEditor'),{mode:{name:selectedLanguage,json:true},theme:'dracula',autoCloseTags:true,autoCloseBrackets:true,lineNumbers:true});editor.on('change',function(instance,changes){var origin=changes.origin;var code=instance.getValue();var cursorPosition=editor.getCursor();onCodeChange(code);if(origin!=='setValue'&&socketContext){socketContext.emit(ACTIONS.CODE_CHANGE,{roomId:roomId,code:code,cursorPosition:{line:cursorPosition.line,ch:cursorPosition.ch},userId:socketContext.userId});}});editor.on('cursorActivity',function(){var cursorPosition=editor.getCursor();socketContext.emit(ACTIONS.SET_CURSOR_POSITION,{roomId:roomId,cursorPosition:{line:cursorPosition.line,ch:cursorPosition.ch},userId:socketContext.userId});});editorRef.current=editor;case 4:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref2.apply(this,arguments);};}();init();},[socketContext,roomId,onCodeChange,selectedLanguage]);useEffect(function(){var handleCodeChange=function handleCodeChange(_ref3){var code=_ref3.code,cursorPosition=_ref3.cursorPosition,userId=_ref3.userId;if(code!==null&&editorRef.current){editorRef.current.setValue(code);}if(cursorPosition&&userId!==socketContext.userId){updateUserCursor(userId,cursorPosition);}};var handleCursorPosition=function handleCursorPosition(_ref4){var cursorPosition=_ref4.cursorPosition,userId=_ref4.userId;if(userId!==socketContext.userId){updateUserCursor(userId,cursorPosition);}};function updateUserCursor(userId,position){setUserCursors(function(prevCursors){return _objectSpread(_objectSpread({},prevCursors),{},_defineProperty({},userId,position));});renderCursors();}function renderCursors(){Object.entries(userCursors).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),userId=_ref6[0],position=_ref6[1];if(editorRef.current){var cursorElement=document.createElement('span');cursorElement.style.borderLeft=\"2px solid \".concat(getUserColor(userId));cursorElement.className='remote-cursor';editorRef.current.setBookmark(position,{widget:cursorElement});}});}if(socketContext){socketContext.on(ACTIONS.CODE_CHANGE,handleCodeChange);socketContext.on(ACTIONS.SET_CURSOR_POSITION,handleCursorPosition);}return function(){if(socketContext){socketContext.off(ACTIONS.CODE_CHANGE);socketContext.off(ACTIONS.SET_CURSOR_POSITION);}};},[socketContext,userCursors]);function getUserColor(userId){// Assign a color based on userId (you can use a color library or hash to generate unique colors)\nreturn'#'+(userId*12345678%0xffffff).toString(16).padStart(6,'0');}return/*#__PURE__*/_jsx(\"textarea\",{id:\"realtimeEditor\"});};export default Editor;","map":{"version":3,"sources":["/Users/PrakharGupta/Major-1/src/components/Editor.js"],"names":["React","useEffect","useRef","useContext","useState","Codemirror","ACTIONS","SocketContext","Editor","roomId","onCodeChange","selectedLanguage","editorRef","socketContext","userCursors","setUserCursors","editor","init","fromTextArea","document","getElementById","mode","name","json","theme","autoCloseTags","autoCloseBrackets","lineNumbers","on","instance","changes","origin","code","getValue","cursorPosition","getCursor","emit","CODE_CHANGE","line","ch","userId","SET_CURSOR_POSITION","current","handleCodeChange","setValue","updateUserCursor","handleCursorPosition","position","prevCursors","renderCursors","Object","entries","forEach","cursorElement","createElement","style","borderLeft","getUserColor","className","setBookmark","widget","off","toString","padStart"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useContext, useState } from 'react';\nimport Codemirror from 'codemirror';\nimport 'codemirror/lib/codemirror.css';\nimport 'codemirror/theme/dracula.css';\nimport 'codemirror/mode/javascript/javascript';\nimport 'codemirror/mode/python/python';\nimport 'codemirror/addon/edit/closetag';\nimport 'codemirror/addon/edit/closebrackets';\nimport ACTIONS from '../Actions';\nimport { SocketContext } from '../socket';\n\nconst Editor = ({ roomId, onCodeChange, selectedLanguage }) => {\n  const editorRef = useRef(null);\n  const socketContext = useContext(SocketContext);\n  const [userCursors, setUserCursors] = useState({});\n\n  useEffect(() => {\n    let editor;\n    const init = async () => {\n      editor = Codemirror.fromTextArea(\n        document.getElementById('realtimeEditor'),\n        {\n          mode: { name: selectedLanguage, json: true },\n          theme: 'dracula',\n          autoCloseTags: true,\n          autoCloseBrackets: true,\n          lineNumbers: true,\n        }\n      );\n\n      editor.on('change', (instance, changes) => {\n        const { origin } = changes;\n        const code = instance.getValue();\n        const cursorPosition = editor.getCursor();\n\n        onCodeChange(code);\n        if (origin !== 'setValue' && socketContext) {\n          socketContext.emit(ACTIONS.CODE_CHANGE, {\n            roomId,\n            code,\n            cursorPosition: { line: cursorPosition.line, ch: cursorPosition.ch },\n            userId: socketContext.userId,\n          });\n        }\n      });\n\n      editor.on('cursorActivity', () => {\n        const cursorPosition = editor.getCursor();\n        socketContext.emit(ACTIONS.SET_CURSOR_POSITION, {\n          roomId,\n          cursorPosition: { line: cursorPosition.line, ch: cursorPosition.ch },\n          userId: socketContext.userId,\n        });\n      });\n\n      editorRef.current = editor;\n    };\n\n    init();\n  }, [socketContext, roomId, onCodeChange, selectedLanguage]);\n\n  useEffect(() => {\n    const handleCodeChange = ({ code, cursorPosition, userId }) => {\n      if (code !== null && editorRef.current) {\n        editorRef.current.setValue(code);\n      }\n      if (cursorPosition && userId !== socketContext.userId) {\n        updateUserCursor(userId, cursorPosition);\n      }\n    };\n\n    const handleCursorPosition = ({ cursorPosition, userId }) => {\n      if (userId !== socketContext.userId) {\n        updateUserCursor(userId, cursorPosition);\n      }\n    };\n\n    function updateUserCursor(userId, position) {\n      setUserCursors((prevCursors) => ({\n        ...prevCursors,\n        [userId]: position,\n      }));\n      renderCursors();\n    }\n\n    function renderCursors() {\n      Object.entries(userCursors).forEach(([userId, position]) => {\n        if (editorRef.current) {\n          const cursorElement = document.createElement('span');\n          cursorElement.style.borderLeft = `2px solid ${getUserColor(userId)}`;\n          cursorElement.className = 'remote-cursor';\n          editorRef.current.setBookmark(position, { widget: cursorElement });\n        }\n      });\n    }\n\n    if (socketContext) {\n      socketContext.on(ACTIONS.CODE_CHANGE, handleCodeChange);\n      socketContext.on(ACTIONS.SET_CURSOR_POSITION, handleCursorPosition);\n    }\n\n    return () => {\n      if (socketContext) {\n        socketContext.off(ACTIONS.CODE_CHANGE);\n        socketContext.off(ACTIONS.SET_CURSOR_POSITION);\n      }\n    };\n  }, [socketContext, userCursors]);\n\n  function getUserColor(userId) {\n    // Assign a color based on userId (you can use a color library or hash to generate unique colors)\n    return '#' + ((userId * 12345678) % 0xffffff).toString(16).padStart(6, '0');\n  }\n\n  return <textarea id=\"realtimeEditor\"></textarea>;\n};\n\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}