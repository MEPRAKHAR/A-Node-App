{"ast":null,"code":"import _asyncToGenerator from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useRef,useEffect}from'react';import toast from'react-hot-toast';import ACTIONS from'../Actions';import Client from'../components/Client';import Editor from'../components/Editor';import{initSocket}from'../socket';import{useLocation,useNavigate,useParams}from'react-router-dom';import ChatBox from'../components/chatbox';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditorPage=function EditorPage(){var _location$state3;var socketRef=useRef(null);var codeRef=useRef(null);var roomRef=useRef(null);var editorRef=useRef(null);var location=useLocation();var _useParams=useParams(),roomId=_useParams.roomId;var reactNavigator=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];var _useState3=useState('javascript'),_useState4=_slicedToArray(_useState3,2),selectedLanguage=_useState4[0],setSelectedLanguage=_useState4[1];useEffect(function(){roomRef.current=roomId;var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _location$state;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return initSocket();case 2:socketRef.current=_context.sent;socketRef.current.on('connect_error',function(err){console.log('socket connect error',err);toast.error('Connection error occurred. Please refresh the page.');});socketRef.current.on('connect_failed',function(err){console.log('socket connect failed',err);toast.error('Failed to connect. Please refresh the page.');});socketRef.current.on('disconnect',function(){console.log('socket disconnected');toast.warning('Disconnected from the room. Refreshing...');setTimeout(function(){return window.location.reload();},2000);});socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});socketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state2;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});});socketRef.current.on(ACTIONS.DISCONNECTED,function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});socketRef.current.on(ACTIONS.CODE_CHANGE,function(_ref4){var code=_ref4.code,cursorPosition=_ref4.cursorPosition;if(code!==codeRef.current){codeRef.current=code;editorRef.current.setValue(code);editorRef.current.setCursor(cursorPosition);}});socketRef.current.on(ACTIONS.SET_CURSOR_POSITION,function(_ref5){var cursorPosition=_ref5.cursorPosition;editorRef.current.setCursor(cursorPosition);});case 11:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();},[roomId,(_location$state3=location.state)===null||_location$state3===void 0?void 0:_location$state3.username]);useEffect(function(){return function(){if(socketRef.current){socketRef.current.disconnect();socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);socketRef.current.off(ACTIONS.CODE_CHANGE);socketRef.current.off(ACTIONS.SET_CURSOR_POSITION);}};},[]);var copyRoomId=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return navigator.clipboard.writeText(roomId);case 3:toast.success('Room ID has been copied to your clipboard');_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);toast.error('Could not copy the Room ID');console.error(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return function copyRoomId(){return _ref6.apply(this,arguments);};}();var leaveRoom=function leaveRoom(){reactNavigator('/');};if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:\"/codemate.jpg\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"button-container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"middle\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,ref:editorRef,roomId:roomId,selectedLanguage:selectedLanguage,onCodeChange:function onCodeChange(code){codeRef.current=code;if(socketRef.current){socketRef.current.emit(ACTIONS.CODE_CHANGE,{roomId:roomId,code:code,cursorPosition:editorRef.current.getCursor()});}}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"right\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Welcome to the Chat\"}),/*#__PURE__*/_jsx(ChatBox,{})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom\"})]});};export default EditorPage;","map":{"version":3,"sources":["/Users/PrakharGupta/Major-1/src/pages/EditorPage.js"],"names":["React","useState","useRef","useEffect","toast","ACTIONS","Client","Editor","initSocket","useLocation","useNavigate","useParams","ChatBox","EditorPage","socketRef","codeRef","roomRef","editorRef","location","roomId","reactNavigator","clients","setClients","selectedLanguage","setSelectedLanguage","current","init","on","err","console","log","error","warning","setTimeout","window","reload","emit","JOIN","username","state","JOINED","socketId","success","SYNC_CODE","code","DISCONNECTED","prev","filter","client","CODE_CHANGE","cursorPosition","setValue","setCursor","SET_CURSOR_POSITION","disconnect","off","copyRoomId","navigator","clipboard","writeText","leaveRoom","map","getCursor"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport toast from 'react-hot-toast';\nimport ACTIONS from '../Actions';\nimport Client from '../components/Client';\nimport Editor from '../components/Editor';\nimport { initSocket } from '../socket';\nimport { useLocation, useNavigate, useParams } from 'react-router-dom';\nimport ChatBox from '../components/chatbox';\n\nconst EditorPage = () => {\n  const socketRef = useRef(null);\n  const codeRef = useRef(null);\n  const roomRef = useRef(null);\n  const editorRef = useRef(null);\n  const location = useLocation();\n  const { roomId } = useParams();\n  const reactNavigator = useNavigate();\n  const [clients, setClients] = useState([]);\n  const [selectedLanguage, setSelectedLanguage] = useState('javascript');\n\n  useEffect(() => {\n    roomRef.current = roomId;\n    const init = async () => {\n      socketRef.current = await initSocket();\n      \n      socketRef.current.on('connect_error', (err) => {\n        console.log('socket connect error', err);\n        toast.error('Connection error occurred. Please refresh the page.');\n      });\n\n      socketRef.current.on('connect_failed', (err) => {\n        console.log('socket connect failed', err);\n        toast.error('Failed to connect. Please refresh the page.');\n      });\n\n      socketRef.current.on('disconnect', () => {\n        console.log('socket disconnected');\n        toast.warning('Disconnected from the room. Refreshing...');\n        setTimeout(() => window.location.reload(), 2000);\n      });\n\n      socketRef.current.emit(ACTIONS.JOIN, {\n        roomId,\n        username: location.state?.username,\n      });\n\n      socketRef.current.on(\n        ACTIONS.JOINED,\n        ({ clients, username, socketId }) => {\n          if (username !== location.state?.username) {\n            toast.success(`${username} joined the room.`);\n            console.log(`${username} joined`);\n          }\n          setClients(clients);\n          socketRef.current.emit(ACTIONS.SYNC_CODE, {\n            code: codeRef.current,\n            socketId,\n          });\n        }\n      );\n\n      socketRef.current.on(\n        ACTIONS.DISCONNECTED,\n        ({ socketId, username }) => {\n          toast.success(`${username} left the room.`);\n          setClients((prev) => {\n            return prev.filter(\n              (client) => client.socketId !== socketId\n            );\n          });\n        }\n      );\n\n      socketRef.current.on(ACTIONS.CODE_CHANGE, ({ code, cursorPosition }) => {\n        if (code !== codeRef.current) {\n          codeRef.current = code;\n          editorRef.current.setValue(code);\n          editorRef.current.setCursor(cursorPosition);\n        }\n      });\n\n      socketRef.current.on(ACTIONS.SET_CURSOR_POSITION, ({ cursorPosition }) => {\n        editorRef.current.setCursor(cursorPosition);\n      });\n    };\n\n    init();\n  }, [roomId, location.state?.username]);\n\n  useEffect(() => {\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n        socketRef.current.off(ACTIONS.JOINED);\n        socketRef.current.off(ACTIONS.DISCONNECTED);\n        socketRef.current.off(ACTIONS.CODE_CHANGE);\n        socketRef.current.off(ACTIONS.SET_CURSOR_POSITION);\n      }\n    };\n  }, []);\n\n  const copyRoomId = async () => {\n    try {\n      await navigator.clipboard.writeText(roomId);\n      toast.success('Room ID has been copied to your clipboard');\n    } catch (err) {\n      toast.error('Could not copy the Room ID');\n      console.error(err);\n    }\n  };\n\n  const leaveRoom = () => {\n    reactNavigator('/');\n  };\n\n  if (!location.state) {\n    return <Navigate to=\"/\" />;\n  }\n\n  return (\n    <div className=\"mainWrap\">\n      <div className=\"aside\">\n        <div className=\"asideInner\">\n          <div className=\"logo\">\n            <img className=\"logoImage\" src=\"/codemate.jpg\" alt=\"logo\" />       \n          </div>\n          <h3>Connected</h3>\n          <div className=\"clientsList\">\n            {clients.map((client) => (\n              <Client\n                key={client.socketId}\n                username={client.username}\n              />\n            ))}\n          </div>\n        </div>\n        <div className=\"button-container\">\n          <button className=\"btn copyBtn\" onClick={copyRoomId}>\n            Copy ROOM ID\n          </button>\n          <button className=\"btn leaveBtn\" onClick={leaveRoom}>\n            Leave\n          </button>\n        </div>\n      </div>\n      <div className=\"middle\">\n        <Editor\n          socketRef={socketRef}\n          ref={editorRef}\n          roomId={roomId}\n          selectedLanguage={selectedLanguage}\n          onCodeChange={(code) => {\n            codeRef.current = code;\n            if (socketRef.current) {\n              socketRef.current.emit(ACTIONS.CODE_CHANGE, {\n                roomId,\n                code,\n                cursorPosition: editorRef.current.getCursor(),\n              });\n            }\n          }}\n        />\n      </div>\n      <div className=\"right\">\n        <h1>Welcome to the Chat</h1>\n        <ChatBox /> \n      </div>\n      <div className=\"bottom\"></div>\n    </div>\n  );\n};\n\nexport default EditorPage;"]},"metadata":{},"sourceType":"module"}