{"ast":null,"code":"import _asyncToGenerator from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/PrakharGupta/Major-1/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useRef,useState}from'react';import Codemirror from'codemirror';import'codemirror/lib/codemirror.css';import'codemirror/theme/dracula.css';import'codemirror/mode/javascript/javascript';import'codemirror/mode/python/python';import'codemirror/addon/edit/closetag';import'codemirror/addon/edit/closebrackets';import ACTIONS from'../Actions';import{jsx as _jsx}from\"react/jsx-runtime\";var Editor=function Editor(_ref){var socketRef=_ref.socketRef,roomId=_ref.roomId,onCodeChange=_ref.onCodeChange,selectedLanguage=_ref.selectedLanguage;var editorRef=useRef(null);var _useState=useState({line:0,ch:0}),_useState2=_slicedToArray(_useState,2),cursorPosition=_useState2[0],setCursorPosition=_useState2[1];var _useState3=useState({anchor:{line:0,ch:0},head:{line:0,ch:0}}),_useState4=_slicedToArray(_useState3,2),selection=_useState4[0],setSelection=_useState4[1];useEffect(function(){function init(){return _init.apply(this,arguments);}function _init(){_init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:editorRef.current=Codemirror.fromTextArea(document.getElementById('realtimeEditor'),{mode:{name:selectedLanguage,json:true},theme:'dracula',autoCloseTags:true,autoCloseBrackets:true,lineNumbers:true});editorRef.current.on('change',function(instance,changes){var origin=changes.origin;var code=instance.getValue();onCodeChange(code);if(origin!=='setValue'){var currentCursor=instance.getCursor();setCursorPosition(currentCursor);var currentSelection=instance.getSelection();setSelection(instance.listSelections()[0]);socketRef.current.emit(ACTIONS.CODE_CHANGE,{roomId:roomId,code:code,cursorPosition:currentCursor,selection:currentSelection?instance.listSelections()[0]:null});}});editorRef.current.on('cursorActivity',function(){var currentCursor=editorRef.current.getCursor();setCursorPosition(currentCursor);socketRef.current.emit(ACTIONS.CURSOR_UPDATE,{roomId:roomId,cursorPosition:currentCursor});});editorRef.current.on('beforeChange',function(instance,changeObj){var origin=changeObj.origin;if(origin==='setValue'){changeObj.cancel();}});case 4:case\"end\":return _context.stop();}}},_callee);}));return _init.apply(this,arguments);}init();},[socketRef,roomId,onCodeChange,selectedLanguage]);useEffect(function(){if(socketRef.current){socketRef.current.on(ACTIONS.CODE_CHANGE,function(_ref2){var code=_ref2.code,cursorPosition=_ref2.cursorPosition,selection=_ref2.selection;if(code!==null){editorRef.current.setValue(code);if(cursorPosition){editorRef.current.setCursor(cursorPosition.line,cursorPosition.ch);}if(selection){editorRef.current.setSelection(selection.anchor,selection.head);}}});socketRef.current.on(ACTIONS.CURSOR_UPDATE,function(_ref3){var cursorPosition=_ref3.cursorPosition;if(cursorPosition){var marker=document.createElement('div');marker.className='remote-cursor';marker.style.cssText=\"\\n                    position: absolute;\\n                    background-color: #ff0000;\\n                    width: 2px;\\n                    height: 20px;\\n                    z-index: 99999;\\n                  \";editorRef.current.addWidget(cursorPosition,marker);}});socketRef.current.on(ACTIONS.DISCONNECTED,function(_ref4){var socketId=_ref4.socketId,username=_ref4.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});}return function(){socketRef.current.off(ACTIONS.CODE_CHANGE);socketRef.current.off(ACTIONS.CURSOR_UPDATE);socketRef.current.off(ACTIONS.DISCONNECTED);};},[socketRef]);return/*#__PURE__*/_jsx(\"textarea\",{id:\"realtimeEditor\"});};export default Editor;","map":{"version":3,"sources":["/Users/PrakharGupta/Major-1/src/components/Editor.js"],"names":["React","useEffect","useRef","useState","Codemirror","ACTIONS","Editor","socketRef","roomId","onCodeChange","selectedLanguage","editorRef","line","ch","cursorPosition","setCursorPosition","anchor","head","selection","setSelection","init","current","fromTextArea","document","getElementById","mode","name","json","theme","autoCloseTags","autoCloseBrackets","lineNumbers","on","instance","changes","origin","code","getValue","currentCursor","getCursor","currentSelection","getSelection","listSelections","emit","CODE_CHANGE","CURSOR_UPDATE","changeObj","cancel","setValue","setCursor","marker","createElement","className","style","cssText","addWidget","DISCONNECTED","socketId","username","toast","success","setClients","prev","filter","client","off"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport Codemirror from 'codemirror';\nimport 'codemirror/lib/codemirror.css';\nimport 'codemirror/theme/dracula.css';\nimport 'codemirror/mode/javascript/javascript';\nimport 'codemirror/mode/python/python';\nimport 'codemirror/addon/edit/closetag';\nimport 'codemirror/addon/edit/closebrackets';\nimport ACTIONS from '../Actions';\n\nconst Editor = ({ socketRef, roomId, onCodeChange, selectedLanguage }) => {\n    const editorRef = useRef(null);\n    const [cursorPosition, setCursorPosition] = useState({ line: 0, ch: 0 });\n  const [selection, setSelection] = useState({ anchor: { line: 0, ch: 0 }, head: { line: 0, ch: 0 } });\n    useEffect(() => {\n        async function init() {\n            editorRef.current = Codemirror.fromTextArea(\n                document.getElementById('realtimeEditor'),\n                {\n                    mode: { name: selectedLanguage, json: true },\n                    theme: 'dracula',\n                    autoCloseTags: true,\n                    autoCloseBrackets: true,\n                    lineNumbers: true,\n                }\n            );\n\n            editorRef.current.on('change', (instance, changes) => {\n                const { origin } = changes;\n                const code = instance.getValue();\n                onCodeChange(code);\n                if (origin !== 'setValue') {\n                    const currentCursor = instance.getCursor();\n                    setCursorPosition(currentCursor);\n                    const currentSelection = instance.getSelection();\n                    setSelection(instance.listSelections()[0]);\n\n                    socketRef.current.emit(ACTIONS.CODE_CHANGE, {\n                        roomId,\n                        code,\n                        cursorPosition: currentCursor,\n                        selection: currentSelection ? instance.listSelections()[0] : null,\n                    });\n                }\n            });\n            editorRef.current.on('cursorActivity', () => {\n                const currentCursor = editorRef.current.getCursor();\n                setCursorPosition(currentCursor);\n                socketRef.current.emit(ACTIONS.CURSOR_UPDATE, {\n                  roomId,\n                  cursorPosition: currentCursor,\n                });\n              });\n        \n              editorRef.current.on('beforeChange', (instance, changeObj) => {\n                const { origin } = changeObj;\n                if (origin === 'setValue') {\n                  changeObj.cancel();\n                }\n              });\n\n\n\n        }\n        init();\n    }, [socketRef, roomId, onCodeChange, selectedLanguage]);\n\n    useEffect(() => {\n        if (socketRef.current) {\n            socketRef.current.on(ACTIONS.CODE_CHANGE, ({ code, cursorPosition, selection }) => {\n              if (code !== null) {\n                editorRef.current.setValue(code);\n      \n                if (cursorPosition) {\n                  editorRef.current.setCursor(cursorPosition.line, cursorPosition.ch);\n                }\n      \n                if (selection) {\n                  editorRef.current.setSelection(selection.anchor, selection.head);\n                }\n              }\n            });\n\n            socketRef.current.on(ACTIONS.CURSOR_UPDATE, ({ cursorPosition }) => {\n                if (cursorPosition) {\n                  const marker = document.createElement('div');\n                  marker.className = 'remote-cursor';\n                  marker.style.cssText = `\n                    position: absolute;\n                    background-color: #ff0000;\n                    width: 2px;\n                    height: 20px;\n                    z-index: 99999;\n                  `;\n                  editorRef.current.addWidget(cursorPosition, marker);\n                }\n              });\n\n              socketRef.current.on(ACTIONS.DISCONNECTED, ({ socketId, username }) => {\n                toast.success(`${username} left the room.`);\n                setClients(prev => prev.filter(client => client.socketId !== socketId));\n              });\n\n\n\n        }\n\n        return () => {\n            socketRef.current.off(ACTIONS.CODE_CHANGE);\n            socketRef.current.off(ACTIONS.CURSOR_UPDATE);\n            socketRef.current.off(ACTIONS.DISCONNECTED);\n        };\n    }, [socketRef]);\n\n    return <textarea id=\"realtimeEditor\"></textarea>;\n};\n\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}